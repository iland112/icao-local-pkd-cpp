# =============================================================================
# HAProxy Configuration for OpenLDAP Load Balancing
# =============================================================================

global
    log stdout format raw local0
    maxconn 4096

defaults
    log global
    mode tcp
    option tcplog
    option dontlognull
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    retries 3

# =============================================================================
# LDAP Frontend (Port 389)
# =============================================================================
frontend ldap_frontend
    bind *:389
    default_backend ldap_backend

# =============================================================================
# LDAP Backend (Round-Robin)
# =============================================================================
backend ldap_backend
    balance roundrobin
    option tcp-check
    tcp-check connect

    server openldap1 openldap1:389 check inter 5s fall 3 rise 2
    server openldap2 openldap2:389 check inter 5s fall 3 rise 2

# =============================================================================
# HAProxy Stats UI (Port 8404)
# =============================================================================
frontend stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if TRUE
